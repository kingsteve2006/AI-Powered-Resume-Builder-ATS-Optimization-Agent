<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Resume Builder & ATS Optimization Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/docx@8.3.2/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ATS-score-circle {
            transition: all 0.5s ease-in-out;
        }
        
        .template-preview {
            transition: all 0.3s ease;
        }
        
        .template-preview:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .live-preview {
            border: 2px dashed #e5e7eb;
            min-height: 400px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .comparison-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .chat-bubble {
            max-width: 80%;
            margin-bottom: 10px;
        }
        
        .user-message {
            background: #3b82f6;
            color: white;
            margin-left: auto;
        }
        
        .ai-message {
            background: #f3f4f6;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center mb-2">AI-Powered Resume Builder</h1>
            <p class="text-center opacity-90">ATS Optimization & Professional Resume Generation</p>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Step Indicator -->
        <div class="flex justify-center mb-8">
            <div class="flex items-center space-x-4 bg-white rounded-lg p-4 shadow-md">
                <div class="flex items-center" id="step1">
                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold">1</div>
                    <span class="ml-2 text-sm font-medium">Input</span>
                </div>
                <div class="w-8 h-0.5 bg-gray-300"></div>
                <div class="flex items-center" id="step2">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-semibold">2</div>
                    <span class="ml-2 text-sm text-gray-600">ATS Score</span>
                </div>
                <div class="w-8 h-0.5 bg-gray-300"></div>
                <div class="flex items-center" id="step3">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-semibold">3</div>
                    <span class="ml-2 text-sm text-gray-600">AI Enhance</span>
                </div>
                <div class="w-8 h-0.5 bg-gray-300"></div>
                <div class="flex items-center" id="step4">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-semibold">4</div>
                    <span class="ml-2 text-sm text-gray-600">Generate</span>
                </div>
            </div>
        </div>

        <!-- Step 1: Input Methods -->
        <div id="inputStep" class="card rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-6">Step 1: Choose Input Method</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Upload Resume -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer" onclick="showUploadSection()">
                    <div class="text-4xl mb-4">üìÑ</div>
                    <h3 class="text-lg font-semibold mb-2">Upload Existing Resume</h3>
                    <p class="text-gray-600 mb-4">Upload your current resume (PDF or DOCX)</p>
                    <input type="file" id="resumeUpload" accept=".pdf,.docx" class="hidden">
                    <button class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors" onclick="document.getElementById('resumeUpload').click()">
                        Choose File
                    </button>
                </div>

                <!-- Manual Entry -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-green-400 transition-colors cursor-pointer" onclick="showManualEntry()">
                    <div class="text-4xl mb-4">‚úèÔ∏è</div>
                    <h3 class="text-lg font-semibold mb-2">Manual Entry</h3>
                    <p class="text-gray-600 mb-4">Enter your details manually</p>
                    <button class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        Start Manual Entry
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" class="card rounded-lg p-6 mb-8 hidden">
            <h3 class="text-xl font-semibold mb-4">Upload Your Resume</h3>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                <input type="file" id="resumeUpload2" accept=".pdf,.docx" class="hidden" onchange="handleFileUpload(event)">
                <div class="text-6xl mb-4">üì§</div>
                <p class="text-lg mb-4">Drag and drop your resume here or click to browse</p>
                <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors" onclick="document.getElementById('resumeUpload2').click()">
                    Select Resume File
                </button>
                <div id="uploadProgress" class="mt-4 hidden">
                    <div class="loading-spinner mx-auto mb-2"></div>
                    <p class="text-sm text-gray-600">Processing your resume...</p>
                </div>
            </div>
        </div>

        <!-- Manual Entry Form -->
        <div id="manualEntrySection" class="card rounded-lg p-6 mb-8 hidden">
            <h3 class="text-xl font-semibold mb-6">Manual Resume Entry</h3>
            <form id="resumeForm" class="space-y-6">
                <!-- Personal Information -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Personal Information</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <input type="text" id="fullName" placeholder="Full Name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="email" id="email" placeholder="Email Address" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="tel" id="phone" placeholder="Phone Number" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="text" id="location" placeholder="Location (City, Country)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="url" id="linkedin" placeholder="LinkedIn Profile" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent md:col-span-2">
                        <input type="url" id="portfolio" placeholder="Portfolio/Website" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent md:col-span-2">
                    </div>
                </div>

                <!-- Professional Summary -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Professional Summary</h4>
                    <textarea id="summary" placeholder="Brief professional summary (2-3 sentences)" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>

                <!-- Education -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Education</h4>
                    <div id="educationContainer" class="space-y-4">
                        <div class="education-item border border-gray-200 rounded-lg p-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <input type="text" placeholder="Degree" class="education-degree w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="Institution" class="education-institution w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="Graduation Year" class="education-year w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="GPA (Optional)" class="education-gpa w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>
                    <button type="button" onclick="addEducationField()" class="mt-2 text-blue-500 hover:text-blue-700">+ Add Education</button>
                </div>

                <!-- Skills -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Skills & Technologies</h4>
                    <textarea id="skills" placeholder="List your skills separated by commas (e.g., JavaScript, React, Node.js, Python)" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>

                <!-- Work Experience -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Work Experience</h4>
                    <div id="experienceContainer" class="space-y-4">
                        <div class="experience-item border border-gray-200 rounded-lg p-4">
                            <div class="grid md:grid-cols-2 gap-4 mb-4">
                                <input type="text" placeholder="Job Title" class="exp-title w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="Company" class="exp-company w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="Start Date" class="exp-start w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <input type="text" placeholder="End Date (or 'Present')" class="exp-end w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <textarea placeholder="Job Description and Achievements" rows="3" class="exp-description w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        </div>
                    </div>
                    <button type="button" onclick="addExperienceField()" class="mt-2 text-blue-500 hover:text-blue-700">+ Add Experience</button>
                </div>

                <!-- Projects -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">Projects</h4>
                    <div id="projectContainer" class="space-y-4">
                        <div class="project-item border border-gray-200 rounded-lg p-4">
                            <input type="text" placeholder="Project Name" class="proj-name w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                            <input type="url" placeholder="Project URL (Optional)" class="proj-url w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                            <textarea placeholder="Project Description and Technologies Used" rows="3" class="proj-description w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        </div>
                    </div>
                    <button type="button" onclick="addProjectField()" class="mt-2 text-blue-500 hover:text-blue-700">+ Add Project</button>
                </div>

                <div class="text-center pt-4">
                    <button type="button" onclick="processResume()" class="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors text-lg font-semibold">
                        Process Resume & Get ATS Score
                    </button>
                </div>
            </form>
        </div>

        <!-- Step 2: ATS Scoring -->
        <div id="atsScoreSection" class="card rounded-lg p-6 mb-8 hidden">
            <h2 class="text-2xl font-semibold mb-6">Step 2: ATS Score Analysis</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Score Display -->
                <div class="text-center">
                    <div id="atsScoreCircle" class="ATS-score-circle w-48 h-48 mx-auto mb-4 relative">
                        <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 200 200">
                            <circle cx="100" cy="100" r="80" stroke="#e5e7eb" stroke-width="20" fill="none"></circle>
                            <circle id="scoreArc" cx="100" cy="100" r="80" stroke="#ef4444" stroke-width="20" fill="none" 
                                    stroke-linecap="round" stroke-dasharray="502.4" stroke-dashoffset="502.4"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <div id="atsScore" class="text-4xl font-bold text-gray-800">0</div>
                                <div class="text-sm text-gray-600">ATS Score</div>
                            </div>
                        </div>
                    </div>
                    <div id="scoreStatus" class="text-lg font-semibold text-red-500">Needs Improvement</div>
                </div>

                <!-- Score Breakdown -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Score Breakdown</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span>Contact Information</span>
                            <span id="contactScore" class="font-semibold">0/20</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="contactBar" class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>

                        <div class="flex justify-between">
                            <span>Work Experience</span>
                            <span id="experienceScore" class="font-semibold">0/30</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="experienceBar" class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>

                        <div class="flex justify-between">
                            <span>Education</span>
                            <span id="educationScore" class="font-semibold">0/20</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="educationBar" class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>

                        <div class="flex justify-between">
                            <span>Skills & Keywords</span>
                            <span id="skillsScore" class="font-semibold">0/30</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="skillsBar" class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h5 class="font-semibold mb-2">Recommendations:</h5>
                        <ul id="recommendations" class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ Add more relevant keywords</li>
                            <li>‚Ä¢ Include quantified achievements</li>
                            <li>‚Ä¢ Improve formatting consistency</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button onclick="startAIEnhancement()" class="bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition-colors text-lg font-semibold">
                    Enhance with AI üöÄ
                </button>
            </div>
        </div>

        <!-- Step 3: AI Enhancement -->
        <div id="aiEnhancementSection" class="card rounded-lg p-6 mb-8 hidden">
            <h2 class="text-2xl font-semibold mb-6">Step 3: AI-Powered Enhancement</h2>
            
            <!-- Enhancement Progress -->
            <div id="enhancementProgress" class="text-center mb-8">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-lg font-semibold">AI is analyzing and enhancing your resume...</p>
                <div class="mt-4 space-y-2">
                    <div id="progress1" class="text-sm text-gray-600">‚úì Parsing resume content</div>
                    <div id="progress2" class="text-sm text-gray-600">‚ö° Optimizing keywords</div>
                    <div id="progress3" class="text-sm text-gray-600">üéØ Enhancing achievements</div>
                    <div id="progress4" class="text-sm text-gray-600">‚ú® Improving readability</div>
                </div>
            </div>

            <!-- Comparison Mode -->
            <div id="comparisonMode" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold">Before vs After Enhancement</h3>
                    <div class="flex space-x-2">
                        <button id="toggleComparison" onclick="toggleComparisonView()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                            Toggle View
                        </button>
                    </div>
                </div>

                <div id="comparisonSplit" class="comparison-split">
                    <!-- Original Resume -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4 text-red-600">Original</h4>
                        <div id="originalResume" class="bg-red-50 border border-red-200 rounded-lg p-4 min-h-96">
                            <!-- Original content will be populated here -->
                        </div>
                    </div>

                    <!-- Enhanced Resume -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4 text-green-600">Enhanced</h4>
                        <div id="enhancedResume" class="bg-green-50 border border-green-200 rounded-lg p-4 min-h-96">
                            <!-- Enhanced content will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Score Improvement Tracker -->
                <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="text-lg font-semibold mb-4">Score Improvement Tracker</h4>
                    <div class="flex items-center justify-between">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600" id="originalScore">0</div>
                            <div class="text-sm text-gray-600">Original Score</div>
                        </div>
                        <div class="text-4xl text-gray-400">‚Üí</div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="newScore">0</div>
                            <div class="text-sm text-gray-600">Enhanced Score</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600" id="improvement">+0</div>
                            <div class="text-sm text-gray-600">Improvement</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Preview -->
            <div id="livePreview" class="mt-8 hidden">
                <h4 class="text-lg font-semibold mb-4">Live Preview</h4>
                <div class="live-preview bg-white border border-gray-200 rounded-lg p-6">
                    <div id="previewContent">
                        <!-- Live preview content -->
                    </div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button onclick="showTemplateSelection()" class="bg-purple-500 text-white px-8 py-3 rounded-lg hover:bg-purple-600 transition-colors text-lg font-semibold">
                    Choose Template & Generate Resume
                </button>
            </div>
        </div>

        <!-- Step 4: Template Selection & Generation -->
        <div id="templateSection" class="card rounded-lg p-6 mb-8 hidden">
            <h2 class="text-2xl font-semibold mb-6">Step 4: Template Selection & Generation</h2>
            
            <h3 class="text-xl font-semibold mb-6">Choose Your Template</h3>
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <!-- Template 1: Modern Professional -->
                <div class="template-preview bg-white border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-500" onclick="selectTemplate('modern')">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">üìÑ</div>
                        <h4 class="text-lg font-semibold">Modern Professional</h4>
                    </div>
                    <div class="border border-gray-200 rounded p-3 text-xs">
                        <div class="font-semibold">John Doe</div>
                        <div class="text-gray-600">Software Engineer</div>
                        <div class="mt-2 h-4 bg-gray-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded"></div>
                    </div>
                </div>

                <!-- Template 2: Executive -->
                <div class="template-preview bg-white border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-500" onclick="selectTemplate('executive')">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">üìã</div>
                        <h4 class="text-lg font-semibold">Executive</h4>
                    </div>
                    <div class="border border-gray-200 rounded p-3 text-xs">
                        <div class="font-semibold text-center">JANE SMITH</div>
                        <div class="text-gray-600 text-center">MARKETING DIRECTOR</div>
                        <div class="mt-2 h-4 bg-gray-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded"></div>
                    </div>
                </div>

                <!-- Template 3: Creative -->
                <div class="template-preview bg-white border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-500" onclick="selectTemplate('creative')">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">üé®</div>
                        <h4 class="text-lg font-semibold">Creative</h4>
                    </div>
                    <div class="border border-gray-200 rounded p-3 text-xs">
                        <div class="font-semibold text-blue-600">Alex Johnson</div>
                        <div class="text-gray-600">UX/UI Designer</div>
                        <div class="mt-2 h-4 bg-blue-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded mb-1"></div>
                        <div class="h-3 bg-gray-200 rounded"></div>
                    </div>
                </div>
            </div>

            <!-- Selected Template Preview -->
            <div id="selectedTemplatePreview" class="hidden mb-8">
                <h4 class="text-lg font-semibold mb-4">Template Preview</h4>
                <div id="templatePreview" class="bg-white border border-gray-300 rounded-lg p-6">
                    <!-- Template preview content -->
                </div>
            </div>

            <!-- Generation Options -->
            <div class="text-center space-x-4">
                <button onclick="generatePDF()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors">
                    üìÑ Generate PDF
                </button>
                <button onclick="generateWord()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                    üìù Generate Word Doc
                </button>
                <button onclick="generateBoth()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors">
                    üéØ Generate Both
                </button>
            </div>
        </div>

        <!-- AI Feedback Chat -->
        <div id="feedbackChat" class="fixed bottom-6 right-6 w-80 hidden">
            <div class="bg-white rounded-lg shadow-xl border">
                <div class="bg-blue-500 text-white p-4 rounded-t-lg flex justify-between items-center">
                    <h4 class="font-semibold">AI Resume Assistant</h4>
                    <button onclick="toggleChat()" class="text-white hover:text-gray-200">‚úï</button>
                </div>
                <div id="chatMessages" class="h-64 overflow-y-auto p-4 space-y-3">
                    <div class="chat-bubble ai-message p-3 rounded-lg">
                        <p class="text-sm">Hello! I'm your AI resume assistant. How can I help improve your resume today?</p>
                    </div>
                </div>
                <div class="p-4 border-t">
                    <div class="flex space-x-2">
                        <input type="text" id="chatInput" placeholder="Ask for feedback..." class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button onclick="sendChatMessage()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Toggle Button -->
        <button id="chatToggleBtn" onclick="toggleChat()" class="fixed bottom-6 right-6 bg-blue-500 text-white p-4 rounded-full shadow-lg hover:bg-blue-600 transition-colors z-50">
            üí¨
        </button>

        <!-- Download Section -->
        <div id="downloadSection" class="card rounded-lg p-6 mb-8 hidden">
            <h2 class="text-2xl font-semibold mb-6 text-center">‚úÖ Your Resume is Ready!</h2>
            <div class="text-center space-y-4">
                <div class="flex justify-center space-x-4">
                    <a id="downloadPDF" href="#" download class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors no-underline">
                        üìÑ Download PDF
                    </a>
                    <a id="downloadWord" href="#" download class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors no-underline">
                        üìù Download Word Doc
                    </a>
                </div>
                <p class="text-gray-600">Your enhanced resume is ready for ATS submission!</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let resumeData = {};
        let atsScore = 0;
        let enhancedData = {};
        let selectedTemplate = '';
        let chatOpen = false;

        // API Configuration - Remove hardcoded keys for security
        const OPENAI_API_KEY = '';
        const GEMINI_API_KEY = '';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateStepIndicator(1);
        });

        // Step navigation
        function updateStepIndicator(step) {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                const circle = stepEl.querySelector('div');
                const text = stepEl.querySelector('span');
                
                if (i <= step) {
                    circle.className = 'w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold';
                    text.className = 'ml-2 text-sm font-medium';
                } else {
                    circle.className = 'w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-semibold';
                    text.className = 'ml-2 text-sm text-gray-600';
                }
            }
        }

        // Show sections
        function showUploadSection() {
            document.getElementById('inputStep').classList.add('hidden');
            document.getElementById('uploadSection').classList.remove('hidden');
        }

        function showManualEntry() {
            document.getElementById('inputStep').classList.add('hidden');
            document.getElementById('manualEntrySection').classList.remove('hidden');
        }

        // Add dynamic fields
        function addEducationField() {
            const container = document.getElementById('educationContainer');
            const newField = document.createElement('div');
            newField.className = 'education-item border border-gray-200 rounded-lg p-4';
            newField.innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <input type="text" placeholder="Degree" class="education-degree w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="Institution" class="education-institution w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="Graduation Year" class="education-year w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="GPA (Optional)" class="education-gpa w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button type="button" onclick="this.parentElement.remove()" class="mt-2 text-red-500 hover:text-red-700 text-sm">Remove</button>
            `;
            container.appendChild(newField);
        }

        function addExperienceField() {
            const container = document.getElementById('experienceContainer');
            const newField = document.createElement('div');
            newField.className = 'experience-item border border-gray-200 rounded-lg p-4';
            newField.innerHTML = `
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <input type="text" placeholder="Job Title" class="exp-title w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="Company" class="exp-company w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="Start Date" class="exp-start w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" placeholder="End Date (or 'Present')" class="exp-end w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <textarea placeholder="Job Description and Achievements" rows="3" class="exp-description w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                <button type="button" onclick="this.parentElement.remove()" class="mt-2 text-red-500 hover:text-red-700 text-sm">Remove</button>
            `;
            container.appendChild(newField);
        }

        function addProjectField() {
            const container = document.getElementById('projectContainer');
            const newField = document.createElement('div');
            newField.className = 'project-item border border-gray-200 rounded-lg p-4';
            newField.innerHTML = `
                <input type="text" placeholder="Project Name" class="proj-name w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                <input type="url" placeholder="Project URL (Optional)" class="proj-url w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3">
                <textarea placeholder="Project Description and Technologies Used" rows="3" class="proj-description w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                <button type="button" onclick="this.parentElement.remove()" class="mt-2 text-red-500 hover:text-red-700 text-sm">Remove</button>
            `;
            container.appendChild(newField);
        }

        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('resume', file);

            document.getElementById('uploadProgress').classList.remove('hidden');

            // Simulate file processing
            setTimeout(() => {
                document.getElementById('uploadProgress').classList.add('hidden');
                alert('File uploaded successfully! In a real implementation, this would parse the PDF/DOCX and extract text.');
                processResume();
            }, 2000);
        }

        // Process resume data
        function processResume() {
            // Collect form data
            resumeData = {
                personal: {
                    name: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    location: document.getElementById('location').value,
                    linkedin: document.getElementById('linkedin').value,
                    portfolio: document.getElementById('portfolio').value
                },
                summary: document.getElementById('summary').value,
                education: [],
                skills: document.getElementById('skills').value,
                experience: [],
                projects: []
            };

            // Collect education
            document.querySelectorAll('.education-item').forEach(item => {
                resumeData.education.push({
                    degree: item.querySelector('.education-degree').value,
                    institution: item.querySelector('.education-institution').value,
                    year: item.querySelector('.education-year').value,
                    gpa: item.querySelector('.education-gpa').value
                });
            });

            // Collect experience
            document.querySelectorAll('.experience-item').forEach(item => {
                resumeData.experience.push({
                    title: item.querySelector('.exp-title').value,
                    company: item.querySelector('.exp-company').value,
                    startDate: item.querySelector('.exp-start').value,
                    endDate: item.querySelector('.exp-end').value,
                    description: item.querySelector('.exp-description').value
                });
            });

            // Collect projects
            document.querySelectorAll('.project-item').forEach(item => {
                resumeData.projects.push({
                    name: item.querySelector('.proj-name').value,
                    url: item.querySelector('.proj-url').value,
                    description: item.querySelector('.proj-description').value
                });
            });

            // Calculate ATS score
            calculateATSScore();
            
            // Show ATS score section
            document.getElementById('manualEntrySection').classList.add('hidden');
            document.getElementById('atsScoreSection').classList.remove('hidden');
            updateStepIndicator(2);
        }

        // ATS Score calculation
        function calculateATSScore() {
            let score = 0;
            let contactScore = 0;
            let experienceScore = 0;
            let educationScore = 0;
            let skillsScore = 0;

            // Contact information (0-20 points)
            if (resumeData.personal.name) contactScore += 4;
            if (resumeData.personal.email) contactScore += 4;
            if (resumeData.personal.phone) contactScore += 4;
            if (resumeData.personal.location) contactScore += 4;
            if (resumeData.personal.linkedin) contactScore += 2;
            if (resumeData.personal.portfolio) contactScore += 2;

            // Work experience (0-30 points)
            if (resumeData.experience.length > 0) {
                experienceScore += 10;
                resumeData.experience.forEach(exp => {
                    if (exp.title && exp.company) experienceScore += 5;
                    if (exp.description && exp.description.length > 50) experienceScore += 5;
                });
            }

            // Education (0-20 points)
            if (resumeData.education.length > 0) {
                educationScore += 10;
                resumeData.education.forEach(edu => {
                    if (edu.degree && edu.institution) educationScore += 5;
                });
            }

            // Skills (0-30 points)
            if (resumeData.skills) {
                const skillCount = resumeData.skills.split(',').length;
                skillsScore = Math.min(skillCount * 3, 30);
            }

            score = contactScore + experienceScore + educationScore + skillsScore;
            atsScore = Math.min(score, 100);

            // Update display
            updateATSScoreDisplay(atsScore, contactScore, experienceScore, educationScore, skillsScore);
        }

        function updateATSScoreDisplay(score, contact, exp, edu, skills) {
            // Update circle
            const circle = document.getElementById('atsScoreCircle');
            const arc = document.getElementById('scoreArc');
            const text = document.getElementById('atsScore');
            const status = document.getElementById('scoreStatus');

            text.textContent = score;
            
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (score / 100) * circumference;
            arc.style.strokeDashoffset = offset;

            if (score >= 80) {
                arc.style.stroke = '#10b981';
                status.textContent = 'Excellent';
                status.className = 'text-lg font-semibold text-green-500';
            } else if (score >= 60) {
                arc.style.stroke = '#f59e0b';
                status.textContent = 'Good';
                status.className = 'text-lg font-semibold text-yellow-500';
            } else {
                arc.style.stroke = '#ef4444';
                status.textContent = 'Needs Improvement';
                status.className = 'text-lg font-semibold text-red-500';
            }

            // Update breakdown
            document.getElementById('contactScore').textContent = `${contact}/20`;
            document.getElementById('experienceScore').textContent = `${exp}/30`;
            document.getElementById('educationScore').textContent = `${edu}/20`;
            document.getElementById('skillsScore').textContent = `${skills}/30`;

            document.getElementById('contactBar').style.width = `${(contact / 20) * 100}%`;
            document.getElementById('experienceBar').style.width = `${(exp / 30) * 100}%`;
            document.getElementById('educationBar').style.width = `${(edu / 20) * 100}%`;
            document.getElementById('skillsBar').style.width = `${(skills / 30) * 100}%`;

            // Update progress bars color
            const bars = ['contactBar', 'experienceBar', 'educationBar', 'skillsBar'];
            bars.forEach(barId => {
                const bar = document.getElementById(barId);
                const percentage = parseInt(bar.style.width);
                if (percentage >= 80) {
                    bar.style.backgroundColor = '#10b981';
                } else if (percentage >= 60) {
                    bar.style.backgroundColor = '#f59e0b';
                } else {
                    bar.style.backgroundColor = '#ef4444';
                }
            });
        }

        // AI Enhancement
        function startAIEnhancement() {
            document.getElementById('atsScoreSection').classList.add('hidden');
            document.getElementById('aiEnhancementSection').classList.remove('hidden');
            updateStepIndicator(3);

            // Simulate AI processing
            setTimeout(() => {
                document.getElementById('progress1').innerHTML = '‚úÖ Parsing resume content';
            }, 500);
            setTimeout(() => {
                document.getElementById('progress2').innerHTML = '‚úÖ Optimizing keywords';
            }, 1500);
            setTimeout(() => {
                document.getElementById('progress3').innerHTML = '‚úÖ Enhancing achievements';
            }, 2500);
            setTimeout(() => {
                document.getElementById('progress4').innerHTML = '‚úÖ Improving readability';
            }, 3500);

            setTimeout(() => {
                document.getElementById('enhancementProgress').classList.add('hidden');
                document.getElementById('comparisonMode').classList.remove('hidden');
                document.getElementById('livePreview').classList.remove('hidden');
                generateEnhancedContent();
            }, 4500);
        }

        async function generateEnhancedContent() {
            // Store original score
            document.getElementById('originalScore').textContent = atsScore;

            // Generate enhanced content
            enhancedData = JSON.parse(JSON.stringify(resumeData)); // Deep copy

            try {
                // Since API keys are removed for security, use fallback enhancement
                console.log('Using fallback enhancement due to security requirements');
                fallbackEnhancement();
            } catch (error) {
                console.error('Enhancement Error:', error);
                alert('Enhancement encountered an error. Using basic enhancement.');
                fallbackEnhancement();
            }
        }

        // OpenAI API Enhancement Functions
        async function callOpenAI(prompt, maxTokens = 500) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: maxTokens,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API Error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch (error) {
                console.error('OpenAI API Error:', error);
                return null;
            }
        }

        // Gemini API Enhancement Functions
        async function callGemini(prompt, maxTokens = 500) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }],
                        generationConfig: {
                            maxOutputTokens: maxTokens,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`Gemini API Error: ${response.status}`);
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text.trim();
            } catch (error) {
                console.error('Gemini API Error:', error);
                return null;
            }
        }

        // AI Enhancement Functions
        async function enhanceSummary(summary) {
            const prompt = `Please enhance this professional summary for a resume to make it more compelling, ATS-friendly, and professional. Keep it concise (2-3 sentences) but impactful:

Original: "${summary}"

Provide an enhanced version that:
1. Uses action verbs and quantifiable achievements
2. Includes relevant industry keywords
3. Maintains professional tone
4. Is optimized for ATS systems
5. Highlights unique value proposition

Enhanced summary:`;

            // Try OpenAI first, then Gemini as fallback
            let enhanced = await callOpenAI(prompt, 200);
            if (!enhanced) {
                enhanced = await callGemini(prompt, 200);
            }

            // Fallback to manual enhancement if both APIs fail
            if (!enhanced) {
                return fallbackSummaryEnhancement(summary);
            }

            return enhanced;
        }

        async function enhanceDescription(description) {
            if (!description) return "";

            const prompt = `Please enhance this job description for a resume to make it more impactful and ATS-optimized. Add quantifiable achievements and action verbs while maintaining the original meaning:

Original: "${description}"

Provide an enhanced version that:
1. Starts with strong action verbs (Led, Developed, Implemented, etc.)
2. Includes specific metrics and numbers where possible
3. Uses industry-relevant keywords
4. Follows STAR format (Situation, Task, Action, Result)
5. Is concise but impactful

Enhanced description:`;

            // Try OpenAI first, then Gemini as fallback
            let enhanced = await callOpenAI(prompt, 300);
            if (!enhanced) {
                enhanced = await callGemini(prompt, 300);
            }

            // Fallback to manual enhancement if both APIs fail
            if (!enhanced) {
                return fallbackDescriptionEnhancement(description);
            }

            return enhanced;
        }

        async function enhanceSkills(skills) {
            const prompt = `Please enhance and expand this skills section for a resume. Add relevant technologies, frameworks, and methodologies that are commonly sought in the industry:

Original: "${skills}"

Provide an enhanced version that:
1. Organizes skills by category (Technical, Soft Skills, etc.)
2. Includes current industry-standard technologies
3. Adds proficiency levels where appropriate
4. Uses ATS-friendly keywords
5. Maintains clarity and readability

Enhanced skills:`;

            // Try OpenAI first, then Gemini as fallback
            let enhanced = await callOpenAI(prompt, 400);
            if (!enhanced) {
                enhanced = await callGemini(prompt, 400);
            }

            // Fallback to manual enhancement if both APIs fail
            if (!enhanced) {
                return fallbackSkillsEnhancement(skills);
            }

            return enhanced;
        }

        // Fallback Enhancement Functions (when APIs fail)
        function fallbackSummaryEnhancement(summary) {
            const enhancements = [
                "Results-driven professional with extensive experience in cross-functional team leadership and strategic project execution. Proven track record of delivering innovative solutions that drive business growth and operational efficiency.",
                "Accomplished specialist with deep expertise in modern technologies and best practices. Demonstrated ability to optimize processes, mentor teams, and deliver high-impact projects that exceed stakeholder expectations.",
                "Dynamic professional combining technical expertise with strong leadership skills. Passionate about leveraging emerging technologies to solve complex challenges and create sustainable competitive advantages."
            ];
            return enhancements[Math.floor(Math.random() * enhancements.length)];
        }

        function fallbackDescriptionEnhancement(description) {
            const enhancements = [
                "‚Ä¢ Led cross-functional team of 8 developers in delivering mission-critical web application, resulting in 40% improvement in user engagement and $200K annual cost savings",
                "‚Ä¢ Architected and implemented scalable microservices infrastructure using React and Node.js, handling 100K+ daily active users with 99.9% uptime",
                "‚Ä¢ Spearheaded digital transformation initiative, modernizing legacy systems and reducing technical debt by 60% while improving system performance by 3x",
                "‚Ä¢ Developed comprehensive testing strategies that increased code coverage from 45% to 95%, significantly reducing production bugs and deployment issues",
                "‚Ä¢ Collaborated with product managers and stakeholders to define technical requirements and deliver features that increased customer satisfaction by 25%"
            ];
            
            const selected = enhancements[Math.floor(Math.random() * enhancements.length)];
            return description + (description ? "\n" : "") + selected;
        }

        function fallbackSkillsEnhancement(skills) {
            const skillEnhancements = {
                "javascript": "JavaScript (ES6+, TypeScript, Node.js, React, Vue.js)",
                "python": "Python (Django, Flask, FastAPI, Data Science, Machine Learning)",
                "java": "Java (Spring Boot, Microservices, Enterprise Applications)",
                "react": "React (Hooks, Context API, Redux, Next.js, Testing Library)",
                "nodejs": "Node.js (Express, GraphQL, REST APIs, Real-time Applications)",
                "html": "HTML5, CSS3, Responsive Design, Bootstrap, Tailwind CSS",
                "css": "CSS3, SASS/SCSS, Flexbox, Grid, Animation",
                "database": "SQL, MySQL, PostgreSQL, MongoDB, Redis",
                "aws": "AWS (EC2, S3, Lambda, RDS, CloudFormation)",
                "docker": "Docker, Kubernetes, Container Orchestration"
            };

            let enhanced = skills;
            for (const [key, value] of Object.entries(skillEnhancements)) {
                if (skills.toLowerCase().includes(key)) {
                    enhanced = enhanced.replace(new RegExp(key, 'gi'), value);
                }
            }
            
            return enhanced;
        }

        function fallbackEnhancement() {
            try {
                // Store original score
                document.getElementById('originalScore').textContent = atsScore;

                // Generate enhanced content using fallback methods
                enhancedData = JSON.parse(JSON.stringify(resumeData)); // Deep copy

                // Ensure enhancedData has proper structure
                if (!enhancedData.personal) enhancedData.personal = {};
                if (!enhancedData.experience) enhancedData.experience = [];
                if (!enhancedData.education) enhancedData.education = [];
                if (!enhancedData.projects) enhancedData.projects = [];

                // Enhance summary
                if (enhancedData.summary && enhancedData.summary.trim()) {
                    enhancedData.summary = fallbackSummaryEnhancement(enhancedData.summary);
                } else {
                    enhancedData.summary = "Results-driven professional with extensive experience in delivering innovative solutions and driving business growth through strategic project execution and team leadership.";
                }

                // Enhance experience descriptions
                if (enhancedData.experience && enhancedData.experience.length > 0) {
                    enhancedData.experience = enhancedData.experience.map(exp => ({
                        ...exp,
                        description: exp.description ? fallbackDescriptionEnhancement(exp.description) : "‚Ä¢ Led key initiatives and delivered measurable results that exceeded expectations"
                    }));
                }

                // Enhance skills
                if (enhancedData.skills && enhancedData.skills.trim()) {
                    enhancedData.skills = fallbackSkillsEnhancement(enhancedData.skills);
                } else {
                    enhancedData.skills = "JavaScript, Python, React, Node.js, SQL, Git, Agile Methodologies, Project Management";
                }

                // Calculate new score
                const newScore = calculateEnhancedScore();
                document.getElementById('newScore').textContent = newScore;
                document.getElementById('improvement').textContent = `+${newScore - atsScore}`;

                // Display content
                displayComparison();
                displayLivePreview();
            } catch (error) {
                console.error('Fallback enhancement error:', error);
                alert('Error during enhancement. Please check your input data and try again.');
            }
        }

        function calculateEnhancedScore() {
            let score = atsScore;
            
            // Bonus for enhanced content
            if (enhancedData.summary && enhancedData.summary.length > 100) score += 5;
            if (enhancedData.experience.some(exp => exp.description && exp.description.includes('‚Ä¢'))) score += 10;
            if (enhancedData.skills && enhancedData.skills.split(',').length > 10) score += 5;
            
            return Math.min(score, 100);
        }

        function displayComparison() {
            const originalDiv = document.getElementById('originalResume');
            const enhancedDiv = document.getElementById('enhancedResume');

            originalDiv.innerHTML = formatResumeContent(resumeData, false);
            enhancedDiv.innerHTML = formatResumeContent(enhancedData, true);
        }

        function formatResumeContent(data, isEnhanced) {
            let html = `
                <div class="space-y-4">
                    <div class="border-b pb-2">
                        <h3 class="text-xl font-bold ${isEnhanced ? 'text-green-600' : 'text-gray-800'}">${data.personal.name || 'Your Name'}</h3>
                        <p class="text-gray-600">${data.personal.email} | ${data.personal.phone}</p>
                        <p class="text-sm text-gray-500">${data.personal.location}</p>
                    </div>
                    
                    ${data.summary ? `<div><h4 class="font-semibold mb-2">Professional Summary</h4><p class="text-sm">${data.summary}</p></div>` : ''}
                    
                    ${data.experience.length > 0 ? '<div><h4 class="font-semibold mb-2">Experience</h4><div class="space-y-2">' + 
                        data.experience.map(exp => `
                            <div>
                                <div class="font-medium">${exp.title} - ${exp.company}</div>
                                <div class="text-sm text-gray-600">${exp.startDate} - ${exp.endDate}</div>
                                <div class="text-sm mt-1">${exp.description.replace(/\n/g, '<br>')}</div>
                            </div>
                        `).join('') + '</div></div>' : ''}
                    
                    ${data.skills ? `<div><h4 class="font-semibold mb-2">Skills</h4><p class="text-sm">${data.skills}</p></div>` : ''}
                </div>
            `;
            return html;
        }

        function displayLivePreview() {
            const previewDiv = document.getElementById('previewContent');
            previewDiv.innerHTML = formatResumeContent(enhancedData, true);
        }

        function toggleComparisonView() {
            const split = document.getElementById('comparisonSplit');
            const isSideBySide = split.classList.contains('comparison-split');
            
            if (isSideBySide) {
                split.classList.remove('comparison-split');
                split.className = 'space-y-8';
            } else {
                split.classList.remove('space-y-8');
                split.className = 'comparison-split';
            }
        }

        // Template selection
        function selectTemplate(template) {
            selectedTemplate = template;
            
            // Update template selection UI
            document.querySelectorAll('.template-preview').forEach(el => {
                el.classList.remove('border-blue-500', 'bg-blue-50');
                el.classList.add('border-gray-300');
            });
            
            event.currentTarget.classList.remove('border-gray-300');
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');
            
            showTemplatePreview();
            document.getElementById('templateSection').scrollIntoView({ behavior: 'smooth' });
        }

        function getTemplateHTML() {
            try {
                if (!enhancedData || !enhancedData.personal) {
                    throw new Error('Enhanced data not available');
                }
                
                switch(selectedTemplate) {
                    case 'modern': return createModernTemplate();
                    case 'executive': return createExecutiveTemplate();
                    case 'creative': return createCreativeTemplate();
                    default: return createModernTemplate();
                }
            } catch (error) {
                console.error('Template generation error:', error);
                return '<div class="p-8"><h1>Error generating template. Please try again.</h1></div>';
            }
        }

        function showTemplatePreview() {
            const previewDiv = document.getElementById('templatePreview');
            const selectedDiv = document.getElementById('selectedTemplatePreview');
            
            selectedDiv.classList.remove('hidden');
            previewDiv.innerHTML = getTemplateHTML();
        }

        function createModernTemplate() {
            return `
                <div class="bg-white p-8 max-w-4xl mx-auto">
                    <div class="text-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">${enhancedData.personal.name || 'Your Name'}</h1>
                        <p class="text-lg text-blue-600 mb-2">${enhancedData.personal.email} | ${enhancedData.personal.phone}</p>
                        <p class="text-gray-600">${enhancedData.personal.location}</p>
                    </div>
                    
                    ${enhancedData.summary ? `
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-blue-600 mb-3 border-b-2 border-blue-200">Professional Summary</h2>
                            <p class="text-gray-700 leading-relaxed">${enhancedData.summary}</p>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.experience.length > 0 ? `
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-blue-600 mb-3 border-b-2 border-blue-200">Work Experience</h2>
                            <div class="space-y-4">
                                ${enhancedData.experience.map(exp => `
                                    <div>
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="text-lg font-semibold text-gray-800">${exp.title}</h3>
                                            <span class="text-sm text-gray-600">${exp.startDate} - ${exp.endDate}</span>
                                        </div>
                                        <p class="text-blue-600 font-medium mb-2">${exp.company}</p>
                                        <div class="text-gray-700">${exp.description.replace(/\n/g, '<br>')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.skills ? `
                        <div>
                            <h2 class="text-xl font-semibold text-blue-600 mb-3 border-b-2 border-blue-200">Technical Skills</h2>
                            <p class="text-gray-700">${enhancedData.skills}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createExecutiveTemplate() {
            return `
                <div class="bg-white p-8 max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2 tracking-wide">${enhancedData.personal.name ? enhancedData.personal.name.toUpperCase() : 'YOUR NAME'}</h1>
                        <p class="text-xl text-gray-600 font-medium tracking-wider">${enhancedData.experience[0]?.title || 'PROFESSIONAL TITLE'}</p>
                    </div>
                    
                    ${enhancedData.summary ? `
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4 uppercase tracking-wider">Executive Summary</h2>
                            <p class="text-gray-700 text-lg leading-relaxed">${enhancedData.summary}</p>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.experience.length > 0 ? `
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4 uppercase tracking-wider">Professional Experience</h2>
                            <div class="space-y-6">
                                ${enhancedData.experience.map(exp => `
                                    <div class="border-l-4 border-gray-400 pl-6">
                                        <div class="mb-3">
                                            <h3 class="text-xl font-bold text-gray-800">${exp.title}</h3>
                                            <p class="text-lg text-gray-600 font-semibold">${exp.company}</p>
                                            <p class="text-gray-500">${exp.startDate} - ${exp.endDate}</p>
                                        </div>
                                        <div class="text-gray-700">${exp.description.replace(/\n/g, '<br>')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.skills ? `
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-4 uppercase tracking-wider">Core Competencies</h2>
                            <p class="text-gray-700 text-lg">${enhancedData.skills}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createCreativeTemplate() {
            return `
                <div class="bg-white p-8 max-w-4xl mx-auto">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-blue-600 mb-2">${enhancedData.personal.name || 'Your Name'}</h1>
                            <p class="text-lg text-gray-600">${enhancedData.personal.email} | ${enhancedData.personal.phone}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-500">üìç ${enhancedData.personal.location}</div>
                        </div>
                    </div>
                    
                    ${enhancedData.summary ? `
                        <div class="mb-6 bg-blue-50 p-4 rounded-lg">
                            <h2 class="text-xl font-semibold text-blue-800 mb-2">About Me</h2>
                            <p class="text-gray-700">${enhancedData.summary}</p>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.experience.length > 0 ? `
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-blue-600 mb-4 border-b-2 border-blue-200">
                                üíº Experience
                            </h2>
                            <div class="grid md:grid-cols-2 gap-4">
                                ${enhancedData.experience.map(exp => `
                                    <div class="border border-blue-200 p-4 rounded-lg">
                                        <h3 class="font-bold text-gray-800">${exp.title}</h3>
                                        <p class="text-blue-600 font-medium">${exp.company}</p>
                                        <p class="text-sm text-gray-500 mb-2">${exp.startDate} - ${exp.endDate}</p>
                                        <div class="text-sm text-gray-700">${exp.description.replace(/\n/g, '<br>')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${enhancedData.skills ? `
                        <div>
                            <h2 class="text-xl font-semibold text-blue-600 mb-4 border-b-2 border-blue-200">
                                ‚ö° Skills & Technologies
                            </h2>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-gray-700">${enhancedData.skills}</p>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Generate documents with enhanced download functionality
        function generatePDF() {
            try {
                if (!selectedTemplate) {
                    alert('Please select a template first!');
                    return;
                }

                if (!enhancedData || !enhancedData.personal) {
                    alert('Please complete the resume enhancement process first!');
                    return;
                }

                if (typeof html2pdf === 'undefined') {
                    alert('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }

                const element = document.createElement('div');
                element.innerHTML = getPDFCompatibleHTML();
                element.style.cssText = `
                    width: 210mm;
                    min-height: 297mm;
                    padding: 20px;
                    font-family: Arial, sans-serif;
                    background-color: #ffffff;
                    color: #000000;
                    line-height: 1.4;
                    position: absolute;
                    left: -9999px;
                `;

                document.body.appendChild(element);

                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: `resume-${(enhancedData.personal.name || 'resume').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff',
                        removeContainer: true
                    },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(element).save().then(() => {
                    document.body.removeChild(element);
                    showDownloadSection();
                }).catch((error) => {
                    console.error('PDF generation error:', error);
                    if (document.body.contains(element)) {
                        document.body.removeChild(element);
                    }
                    alert('Error generating PDF: ' + error.message);
                });

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function getPDFCompatibleHTML() {
            const data = enhancedData;
            return `
                <div style="background: white; color: black; font-family: Arial, sans-serif; line-height: 1.4;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <h1 style="font-size: 28px; font-weight: bold; color: #1f2937; margin-bottom: 8px;">${data.personal.name || 'Your Name'}</h1>
                        <p style="font-size: 16px; color: #3b82f6; margin-bottom: 8px;">${data.personal.email} | ${data.personal.phone}</p>
                        <p style="color: #6b7280;">${data.personal.location}</p>
                    </div>
                    
                    ${data.summary ? `
                        <div style="margin-bottom: 24px;">
                            <h2 style="font-size: 18px; font-weight: bold; color: #3b82f6; margin-bottom: 12px; border-bottom: 2px solid #dbeafe; padding-bottom: 4px;">Professional Summary</h2>
                            <p style="color: #374151; line-height: 1.6;">${data.summary}</p>
                        </div>
                    ` : ''}
                    
                    ${data.experience && data.experience.length > 0 ? `
                        <div style="margin-bottom: 24px;">
                            <h2 style="font-size: 18px; font-weight: bold; color: #3b82f6; margin-bottom: 12px; border-bottom: 2px solid #dbeafe; padding-bottom: 4px;">Work Experience</h2>
                            <div>
                                ${data.experience.map(exp => `
                                    <div style="margin-bottom: 16px;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <h3 style="font-size: 16px; font-weight: bold; color: #1f2937;">${exp.title}</h3>
                                            <span style="font-size: 12px; color: #6b7280;">${exp.startDate} - ${exp.endDate}</span>
                                        </div>
                                        <p style="color: #3b82f6; font-weight: 500; margin-bottom: 8px;">${exp.company}</p>
                                        <div style="color: #374151;">${exp.description.replace(/\n/g, '<br>')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.skills ? `
                        <div>
                            <h2 style="font-size: 18px; font-weight: bold; color: #3b82f6; margin-bottom: 12px; border-bottom: 2px solid #dbeafe; padding-bottom: 4px;">Technical Skills</h2>
                            <p style="color: #374151;">${data.skills}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function generateWord() {
            try {
                if (!selectedTemplate) {
                    alert('Please select a template first!');
                    return;
                }

                if (!enhancedData || !enhancedData.personal) {
                    alert('Please complete the resume enhancement process first!');
                    return;
                }

                // Check if docx library is loaded
                if (typeof docx === 'undefined') {
                    alert('Word document library not loaded. Please refresh the page and try again.');
                    return;
                }

                const children = [];
                
                // Name
                children.push(new docx.Paragraph({
                    alignment: docx.AlignmentType.CENTER,
                    children: [new docx.TextRun({
                        text: enhancedData.personal.name || 'Your Name',
                        bold: true,
                        size: 32
                    })]
                }));
                
                // Contact
                const contactInfo = [];
                if (enhancedData.personal.email) contactInfo.push(enhancedData.personal.email);
                if (enhancedData.personal.phone) contactInfo.push(enhancedData.personal.phone);
                if (enhancedData.personal.location) contactInfo.push(enhancedData.personal.location);
                
                if (contactInfo.length > 0) {
                    children.push(new docx.Paragraph({
                        alignment: docx.AlignmentType.CENTER,
                        children: [new docx.TextRun({
                            text: contactInfo.join(' | '),
                            size: 24
                        })]
                    }));
                }
                
                // Summary
                if (enhancedData.summary) {
                    children.push(new docx.Paragraph({
                        children: [new docx.TextRun({ text: 'PROFESSIONAL SUMMARY', bold: true, size: 28 })],
                        spacing: { before: 400, after: 200 }
                    }));
                    children.push(new docx.Paragraph({ 
                        text: enhancedData.summary,
                        spacing: { after: 200 }
                    }));
                }
                
                // Experience
                if (enhancedData.experience && enhancedData.experience.length > 0) {
                    children.push(new docx.Paragraph({
                        children: [new docx.TextRun({ text: 'WORK EXPERIENCE', bold: true, size: 28 })],
                        spacing: { before: 400, after: 200 }
                    }));
                    
                    enhancedData.experience.forEach(exp => {
                        if (exp.title) {
                            children.push(new docx.Paragraph({
                                children: [new docx.TextRun({ text: exp.title, bold: true, size: 24 })]
                            }));
                        }
                        if (exp.company) {
                            children.push(new docx.Paragraph({ 
                                text: exp.company,
                                spacing: { after: 100 }
                            }));
                        }
                        if (exp.startDate || exp.endDate) {
                            children.push(new docx.Paragraph({ 
                                text: `${exp.startDate || ''} - ${exp.endDate || ''}`,
                                spacing: { after: 100 }
                            }));
                        }
                        if (exp.description) {
                            children.push(new docx.Paragraph({ 
                                text: exp.description,
                                spacing: { after: 200 }
                            }));
                        }
                    });
                }
                
                // Skills
                if (enhancedData.skills) {
                    children.push(new docx.Paragraph({
                        children: [new docx.TextRun({ text: 'SKILLS', bold: true, size: 28 })],
                        spacing: { before: 400, after: 200 }
                    }));
                    children.push(new docx.Paragraph({ text: enhancedData.skills }));
                }

                const doc = new docx.Document({
                    sections: [{ 
                        properties: {},
                        children: children
                    }]
                });

                docx.Packer.toBlob(doc).then(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `resume-${(enhancedData.personal.name || 'resume').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.docx`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showDownloadSection();
                }).catch(error => {
                    console.error('Word generation error:', error);
                    alert('Error generating Word document: ' + error.message);
                });

            } catch (error) {
                console.error('Word generation error:', error);
                alert('Error generating Word document: ' + error.message);
            }
        }

        function generateBoth() {
            // Generate PDF first
            generatePDF();
            
            // Then generate Word document after a short delay
            setTimeout(() => {
                generateWord();
            }, 2000);
        }

        function showDownloadSection() {
            const downloadSection = document.getElementById('downloadSection');
            downloadSection.classList.remove('hidden');
            
            // Update download links with actual data
            const name = enhancedData.personal.name || 'resume';
            const timestamp = new Date().getTime();
            
            // Note: In a real implementation, we would store the generated blobs
            // For now, we'll show the download section with proper styling
            const pdfLink = document.getElementById('downloadPDF');
            const wordLink = document.getElementById('downloadWord');
            
            pdfLink.textContent = 'üìÑ Download PDF';
            wordLink.textContent = 'üìù Download Word Doc';
            
            // Scroll to download section
            downloadSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showTemplateSelection() {
            document.getElementById('aiEnhancementSection').classList.add('hidden');
            document.getElementById('templateSection').classList.remove('hidden');
            updateStepIndicator(4);
        }

        // Chat functionality
        function toggleChat() {
            const chat = document.getElementById('feedbackChat');
            const btn = document.getElementById('chatToggleBtn');
            
            if (chatOpen) {
                chat.classList.add('hidden');
                btn.textContent = 'üí¨';
            } else {
                chat.classList.remove('hidden');
                btn.textContent = '‚úï';
            }
            
            chatOpen = !chatOpen;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            
            if (!input.value.trim()) return;
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-bubble user-message p-3 rounded-lg ml-auto text-right';
            userMsg.innerHTML = `<p class="text-sm">${input.value}</p>`;
            messages.appendChild(userMsg);
            
            // Clear input
            const userMessage = input.value;
            input.value = '';
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
            
            // Add loading indicator
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'chat-bubble ai-message p-3 rounded-lg';
            loadingMsg.innerHTML = `<p class="text-sm">ü§ñ AI is thinking...</p>`;
            messages.appendChild(loadingMsg);
            messages.scrollTop = messages.scrollHeight;
            
            // Get AI response
            try {
                const response = await getAIChatResponse(userMessage);
                loadingMsg.remove();
                
                const aiMsg = document.createElement('div');
                aiMsg.className = 'chat-bubble ai-message p-3 rounded-lg';
                aiMsg.innerHTML = `<p class="text-sm">${response}</p>`;
                messages.appendChild(aiMsg);
            } catch (error) {
                loadingMsg.remove();
                
                const aiMsg = document.createElement('div');
                aiMsg.className = 'chat-bubble ai-message p-3 rounded-lg';
                aiMsg.innerHTML = `<p class="text-sm">I apologize, but I'm having trouble processing your request right now. Please try again in a moment.</p>`;
                messages.appendChild(aiMsg);
            }
            
            messages.scrollTop = messages.scrollHeight;
        }

        async function getAIChatResponse(message) {
            const prompt = `You are an expert resume writing assistant helping someone improve their resume. Provide helpful, specific, and actionable advice for resume optimization and ATS improvement.

User question: "${message}"

Provide a helpful response that:
1. Gives specific, actionable advice
2. Focuses on ATS optimization
3. Includes concrete examples when relevant
4. Is professional and encouraging
5. Addresses resume formatting, content, or industry-specific tips

Response:`;

            // Try OpenAI first, then Gemini as fallback
            let response = await callOpenAI(prompt, 300);
            if (!response) {
                response = await callGemini(prompt, 300);
            }

            // Fallback to manual response if both APIs fail
            if (!response) {
                return fallbackChatResponse(message);
            }

            return response;
        }

        function fallbackChatResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('summary') || lowerMessage.includes('objective')) {
                return "For your professional summary, focus on your unique value proposition in 2-3 sentences. Include your key skills, years of experience, and most impressive achievements. Make sure it's tailored to the job you're applying for.";
            }
            
            if (lowerMessage.includes('experience') || lowerMessage.includes('work')) {
                return "When describing your work experience, use the STAR method (Situation, Task, Action, Result). Start each bullet with strong action verbs like 'Led', 'Developed', 'Implemented', 'Achieved', and include specific metrics and numbers whenever possible.";
            }
            
            if (lowerMessage.includes('skills') || lowerMessage.includes('technical')) {
                return "Organize your skills section by category (Technical Skills, Soft Skills, etc.) and include both hard skills and relevant technologies. Make sure to include keywords that match job descriptions in your field.";
            }
            
            if (lowerMessage.includes('ats') || lowerMessage.includes('keyword')) {
                return "For ATS optimization, include keywords from the job description naturally throughout your resume. Use standard job titles, avoid graphics or tables that ATS systems can't read, and ensure your contact information is clearly formatted.";
            }
            
            if (lowerMessage.includes('format') || lowerMessage.includes('layout')) {
                return "Keep your resume format clean and ATS-friendly: use standard fonts like Arial or Calibri, consistent formatting, clear section headers, and avoid tables or text boxes that might confuse ATS systems.";
            }
            
            const responses = [
                "Great question! For resume improvement, focus on quantifying your achievements with specific numbers and metrics. This makes your accomplishments more tangible and impressive to both ATS systems and human recruiters.",
                "Your resume is looking good! Consider adding a skills section with relevant technical keywords for your industry, and make sure your job titles match common industry terminology.",
                "I notice you have solid experience. Try organizing your bullet points using action verbs like 'led', 'developed', 'implemented' for maximum impact and ATS compatibility.",
                "For ATS optimization, ensure your resume includes relevant keywords naturally throughout, uses standard job titles, and maintains clean formatting without complex graphics or tables.",
                "Consider expanding your professional summary to highlight your unique value proposition and key accomplishments in 2-3 compelling sentences that grab attention immediately.",
                "Your work experience section could benefit from more specific details about the technologies, methodologies, and measurable results you achieved in each role."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Add chat button event listener
        document.getElementById('chatToggleBtn')?.addEventListener('click', toggleChat);
    </script>
</body>
</html>